{"ast":null,"code":"var request = require('request');\nvar cheerio = require('cheerio');\nvar querystring = require('querystring');\nvar util = require('util');\nvar linkSel = 'h3.r a';\nvar descSel = 'div.s';\nvar itemSel = 'div.g';\nvar nextSel = 'td.b a span';\nvar URL = '%s://www.google.%s/search?hl=%s&q=%s&start=%s&sa=N&num=%s&ie=UTF-8&oe=UTF-8&gws_rd=ssl';\nvar nextTextErrorMsg = 'Translate `google.nextText` option to selected language to detect next results link.';\nvar protocolErrorMsg = \"Protocol `google.protocol` needs to be set to either 'http' or 'https', please use a valid protocol. Setting the protocol to 'https'.\";\n\n// start parameter is optional\nfunction google(query, start, callback) {\n  var startIndex = 0;\n  if (typeof callback === 'undefined') {\n    callback = start;\n  } else {\n    startIndex = start;\n  }\n  igoogle(query, startIndex, callback);\n}\ngoogle.resultsPerPage = 10;\ngoogle.tld = 'com';\ngoogle.lang = 'en';\ngoogle.requestOptions = {};\ngoogle.nextText = 'Next';\ngoogle.protocol = 'https';\nvar igoogle = function (query, start, callback) {\n  if (google.resultsPerPage > 100) google.resultsPerPage = 100; // Google won't allow greater than 100 anyway\n  if (google.lang !== 'en' && google.nextText === 'Next') console.warn(nextTextErrorMsg);\n  if (google.protocol !== 'http' && google.protocol !== 'https') {\n    google.protocol = 'https';\n    console.warn(protocolErrorMsg);\n  }\n\n  // timeframe is optional. splice in if set\n  if (google.timeSpan) {\n    URL = URL.indexOf('tbs=qdr:') >= 0 ? URL.replace(/tbs=qdr:[snhdwmy]\\d*/, 'tbs=qdr:' + google.timeSpan) : URL.concat('&tbs=qdr:', google.timeSpan);\n  }\n  var newUrl = util.format(URL, google.protocol, google.tld, google.lang, querystring.escape(query), start, google.resultsPerPage);\n  var requestOptions = {\n    url: newUrl,\n    method: 'GET'\n  };\n  for (var k in google.requestOptions) {\n    requestOptions[k] = google.requestOptions[k];\n  }\n  request(requestOptions, function (err, resp, body) {\n    if (err == null && resp.statusCode === 200) {\n      var $ = cheerio.load(body);\n      var res = {\n        url: newUrl,\n        query: query,\n        start: start,\n        links: [],\n        $: $,\n        body: body\n      };\n      $(itemSel).each(function (i, elem) {\n        var linkElem = $(elem).find(linkSel);\n        var descElem = $(elem).find(descSel);\n        var item = {\n          title: $(linkElem).first().text(),\n          link: null,\n          description: null,\n          href: null\n        };\n        var qsObj = querystring.parse($(linkElem).attr('href'));\n        if (qsObj['/url?q']) {\n          item.link = qsObj['/url?q'];\n          item.href = item.link;\n        }\n        $(descElem).find('div').remove();\n        item.description = $(descElem).text();\n        res.links.push(item);\n      });\n      if ($(nextSel).last().text() === google.nextText) {\n        res.next = function () {\n          igoogle(query, start + google.resultsPerPage, callback);\n        };\n      }\n      callback(null, res);\n    } else {\n      callback(new Error('Error on response' + (resp ? ' (' + resp.statusCode + ')' : '') + ':' + err + ' : ' + body), null, null);\n    }\n  });\n};\nmodule.exports = google;","map":{"version":3,"names":["request","require","cheerio","querystring","util","linkSel","descSel","itemSel","nextSel","URL","nextTextErrorMsg","protocolErrorMsg","google","query","start","callback","startIndex","igoogle","resultsPerPage","tld","lang","requestOptions","nextText","protocol","console","warn","timeSpan","indexOf","replace","concat","newUrl","format","escape","url","method","k","err","resp","body","statusCode","$","load","res","links","each","i","elem","linkElem","find","descElem","item","title","first","text","link","description","href","qsObj","parse","attr","remove","push","last","next","Error","module","exports"],"sources":["/Users/terencemui/Documents/ttWebsite/tt-website/node_modules/google/lib/google.js"],"sourcesContent":["var request = require('request')\nvar cheerio = require('cheerio')\nvar querystring = require('querystring')\nvar util = require('util')\n\nvar linkSel = 'h3.r a'\nvar descSel = 'div.s'\nvar itemSel = 'div.g'\nvar nextSel = 'td.b a span'\n\nvar URL = '%s://www.google.%s/search?hl=%s&q=%s&start=%s&sa=N&num=%s&ie=UTF-8&oe=UTF-8&gws_rd=ssl'\n\nvar nextTextErrorMsg = 'Translate `google.nextText` option to selected language to detect next results link.'\nvar protocolErrorMsg = \"Protocol `google.protocol` needs to be set to either 'http' or 'https', please use a valid protocol. Setting the protocol to 'https'.\"\n\n// start parameter is optional\nfunction google (query, start, callback) {\n  var startIndex = 0\n  if (typeof callback === 'undefined') {\n    callback = start\n  } else {\n    startIndex = start\n  }\n  igoogle(query, startIndex, callback)\n}\n\ngoogle.resultsPerPage = 10\ngoogle.tld = 'com'\ngoogle.lang = 'en'\ngoogle.requestOptions = {}\ngoogle.nextText = 'Next'\ngoogle.protocol = 'https'\n\nvar igoogle = function (query, start, callback) {\n  if (google.resultsPerPage > 100) google.resultsPerPage = 100 // Google won't allow greater than 100 anyway\n  if (google.lang !== 'en' && google.nextText === 'Next') console.warn(nextTextErrorMsg)\n  if (google.protocol !== 'http' && google.protocol !== 'https') {\n    google.protocol = 'https'\n    console.warn(protocolErrorMsg)\n  }\n\n  // timeframe is optional. splice in if set\n  if (google.timeSpan) {\n    URL = URL.indexOf('tbs=qdr:') >= 0 ? URL.replace(/tbs=qdr:[snhdwmy]\\d*/, 'tbs=qdr:' + google.timeSpan) : URL.concat('&tbs=qdr:', google.timeSpan)\n  }\n  var newUrl = util.format(URL, google.protocol, google.tld, google.lang, querystring.escape(query), start, google.resultsPerPage)\n  var requestOptions = {\n    url: newUrl,\n    method: 'GET'\n  }\n\n  for (var k in google.requestOptions) {\n    requestOptions[k] = google.requestOptions[k]\n  }\n\n  request(requestOptions, function (err, resp, body) {\n    if ((err == null) && resp.statusCode === 200) {\n      var $ = cheerio.load(body)\n      var res = {\n        url: newUrl,\n        query: query,\n        start: start,\n        links: [],\n        $: $,\n        body: body\n      }\n\n      $(itemSel).each(function (i, elem) {\n        var linkElem = $(elem).find(linkSel)\n        var descElem = $(elem).find(descSel)\n        var item = {\n          title: $(linkElem).first().text(),\n          link: null,\n          description: null,\n          href: null\n        }\n        var qsObj = querystring.parse($(linkElem).attr('href'))\n\n        if (qsObj['/url?q']) {\n          item.link = qsObj['/url?q']\n          item.href = item.link\n        }\n\n        $(descElem).find('div').remove()\n        item.description = $(descElem).text()\n\n        res.links.push(item)\n      })\n\n      if ($(nextSel).last().text() === google.nextText) {\n        res.next = function () {\n          igoogle(query, start + google.resultsPerPage, callback)\n        }\n      }\n\n      callback(null, res)\n    } else {\n      callback(new Error('Error on response' + (resp ? ' (' + resp.statusCode + ')' : '') + ':' + err + ' : ' + body), null, null)\n    }\n  })\n}\n\nmodule.exports = google\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}